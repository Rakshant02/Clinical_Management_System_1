
<div class="container mt-3" *ngIf="deviation as d">
  <div class="d-flex justify-content-between align-items-center">
    <h4>Deviation {{ d.deviationId }}</h4>
    <div>
      <span class="badge bg-secondary me-2">{{ d.status }}</span>
      <span class="badge"
            [ngClass]="{
              'bg-secondary': d.severity === 'MINOR',
              'bg-warning text-dark': d.severity === 'MAJOR',
              'bg-danger': d.severity === 'CRITICAL'
            }">{{ d.severity }}</span>
    </div>
  </div>

  <div class="card mt-3">
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <p><b>Protocol:</b> {{ d.protocolId }}</p>
          <p><b>Participant:</b> {{ d.participantId }}</p>
          <p><b>Observation:</b> {{ d.observationId || '—' }}</p>
          <p><b>Detected By:</b> {{ d.detectedBy }}</p>
        </div>
        <div class="col-md-6">
          <p><b>Reported:</b> {{ d.reportedDate | date:'medium' }}</p>
          <p><b>CAPA Ref:</b> {{ d.capaReference || '—' }}</p>
          <p><b>Corrective Action:</b> {{ d.correctiveAction || '—' }}</p>
        </div>
      </div>
      <p class="mt-3"><b>Description:</b><br>{{ d.description }}</p>

      <div class="mt-3">
        <button class="btn btn-outline-secondary me-2" (click)="setStatus('UNDER_REVIEW')">Mark Under Review</button>
        <button class="btn btn-success" (click)="setStatus('CLOSED')">Close</button>
      </div>
    </div>
  </div>
</div>
