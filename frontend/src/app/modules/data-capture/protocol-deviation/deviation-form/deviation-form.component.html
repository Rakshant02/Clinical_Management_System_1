
<div class="container mt-3 deviation-form">
  <div class="d-flex justify-content-between align-items-center">
    <h4 class="mb-0">New Protocol Deviation</h4>
  </div>

  <div class="card mt-3">
    <div class="card-body">
      <form [formGroup]="form" (ngSubmit)="submit()">
        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label">Protocol ID</label>
            <input class="form-control" formControlName="protocolId" placeholder="TP-1024">
            <div class="invalid-msg" *ngIf="form.get('protocolId')?.touched && form.get('protocolId')?.invalid">
              Protocol ID is required.
            </div>
          </div>

          <div class="col-md-4 mb-3">
            <label class="form-label">Participant ID</label>
            <input class="form-control" formControlName="participantId" placeholder="P-7788">
            <div class="invalid-msg" *ngIf="form.get('participantId')?.touched && form.get('participantId')?.invalid">
              Participant ID is required.
            </div>
          </div>

          <div class="col-md-4 mb-3">
            <label class="form-label">Observation ID (optional)</label>
            <input class="form-control" formControlName="observationId" placeholder="O-9900">
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea class="form-control" rows="4" formControlName="description"
                    placeholder="Describe the deviation (e.g., visit outside window, prohibited concomitant meds)"></textarea>
          <div class="invalid-msg" *ngIf="form.get('description')?.touched && form.get('description')?.invalid">
            Description (min 10 characters) is required.
          </div>
        </div>

        <div class="row">
          <div class="col-md-4 mb-3">
            <label class="form-label">Severity</label>
            <select class="form-select" formControlName="severity">
              <option value="MINOR">Minor</option>
              <option value="MAJOR">Major</option>
              <option value="CRITICAL">Critical</option>
            </select>
          </div>

          <div class="col-md-4 mb-3">
            <label class="form-label">Detected By</label>
            <input class="form-control" formControlName="detectedBy" placeholder="investigator/user id">
          </div>

          <div class="col-md-4 mb-3">
            <label class="form-label">Reported Date</label>
            <input class="form-control" type="datetime-local"
                   [value]="form.value.reportedDate | date:'yyyy-MM-ddTHH:mm'"
                   (input)="form.patchValue({ reportedDate: $any($event.target).value })">
          </div>
        </div>

        
<div class="d-flex justify-content-end">
    <button
      class="btn btn-danger"
      type="submit"
      [disabled]="saving || form.invalid">
      {{ saving ? 'Savingâ€¦' : 'Create' }}
    </button>
  </div>

      </form>
    </div>
  </div>
</div>
